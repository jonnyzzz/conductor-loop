<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Conductor Loop</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>

  <!-- Header -->
  <div id="header">
    <span class="title">CONDUCTOR LOOP</span>
    <span class="separator">|</span>
    <span id="health-indicator">
      <span id="health-dot" class="dot warn">●</span>
      <span id="health-label">Connecting...</span>
    </span>
    <span id="status-uptime"></span>
  </div>

  <!-- Workspace: sidebar + content -->
  <div id="workspace">

    <!-- Left sidebar: projects -->
    <div id="sidebar">
      <div class="panel-hdr">Projects <button onclick="openNewTaskModal()" title="New Task">+</button></div>
      <div id="project-list" class="scroll-list">
        <p class="empty">Loading...</p>
      </div>
    </div>

    <!-- Right content: tasks + run detail -->
    <div id="content">

      <!-- Tasks panel -->
      <div id="tasks-area" style="flex:1;display:flex;flex-direction:column;min-height:0;overflow:hidden;">
        <div class="panel-hdr">
          <span id="main-header">Tasks</span>
        </div>
        <div id="main-panel" class="scroll-list">
          <p class="empty">Select a project</p>
        </div>
      </div>

      <!-- Run detail panel (hidden until run selected) -->
      <div id="run-detail" class="hidden">
        <div class="panel-hdr">
          Run Detail
          <button id="stop-run-btn" class="btn-stop hidden" onclick="stopCurrentRun()" title="Stop">&#9632; Stop</button>
          <button onclick="closeRun()" title="Close">✕</button>
        </div>
        <div id="run-meta" class="run-meta-bar"></div>
        <div class="tab-bar">
          <button class="tab-btn" data-tab="stdout">STDOUT</button>
          <button class="tab-btn" data-tab="stderr">STDERR</button>
          <button class="tab-btn" data-tab="prompt">PROMPT</button>
          <button class="tab-btn active" data-tab="output.md">OUTPUT</button>
          <button class="tab-btn" data-tab="messages">MESSAGES</button>
        </div>
        <pre id="tab-content"></pre>
      </div>

    </div><!-- /content -->
  </div><!-- /workspace -->

  <!-- New Task Modal -->
  <dialog id="new-task-dialog">
    <div class="dialog-hdr">
      <span>NEW TASK</span>
      <button onclick="closeNewTaskModal()" title="Close">✕</button>
    </div>
    <form id="new-task-form" onsubmit="submitNewTask(); return false;">
      <div class="form-row">
        <label for="nt-project-id">Project ID *</label>
        <input type="text" id="nt-project-id" required placeholder="my-project">
      </div>
      <div class="form-row">
        <label for="nt-task-id">Task ID</label>
        <input type="text" id="nt-task-id" placeholder="auto-generated">
      </div>
      <div class="form-row">
        <label for="nt-agent-type">Agent</label>
        <select id="nt-agent-type">
          <option value="claude">claude</option>
          <option value="codex">codex</option>
          <option value="gemini">gemini</option>
          <option value="perplexity">perplexity</option>
          <option value="xai">xai</option>
        </select>
      </div>
      <div class="form-row">
        <label for="nt-prompt">Prompt *</label>
        <textarea id="nt-prompt" required rows="6" placeholder="Describe the task..."></textarea>
      </div>
      <div class="form-row">
        <label for="nt-project-root">Project Root</label>
        <input type="text" id="nt-project-root" placeholder="server's working directory">
      </div>
      <div class="form-row">
        <label for="nt-attach-mode">Attach Mode</label>
        <select id="nt-attach-mode">
          <option value="create">create</option>
          <option value="attach">attach</option>
          <option value="resume">resume</option>
        </select>
      </div>
      <div id="nt-error" class="form-error hidden"></div>
      <div class="form-actions">
        <button type="button" onclick="closeNewTaskModal()" class="btn-cancel">Cancel</button>
        <button type="submit" class="btn-submit">Create Task</button>
      </div>
    </form>
  </dialog>

  <!-- Toast notification -->
  <div id="toast" class="toast hidden"></div>

  <script src="app.js"></script>
</body>
</html>
