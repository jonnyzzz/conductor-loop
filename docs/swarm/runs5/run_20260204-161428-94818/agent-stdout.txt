The Perplexity API is not available, but I can proceed with the review based on the documentation I've read. Let me analyze the content:

## Runner & Orchestration Review

### 1) External Facts Check

**Unable to verify external facts via Perplexity MCP** (API authentication failed). However, the spec mentions the following technical claims that are generally accurate based on common knowledge:

- **HCL (Hashicorp Configuration Language)**: Standard config format, widely used (Terraform, Consul, etc.). ✓
- **SSE (Server-Sent Events) for streaming**: Standard HTML5 protocol for one-way server-to-client streaming. ✓
- **SIGTERM/SIGKILL process termination**: Standard POSIX signals; grace period before SIGKILL is best practice. ✓
- **Process group (PGID) for process tree management**: Standard UNIX process management. ✓
- **UTC timestamp format `YYYYMMDD-HHMMSSMMMM-PID`**: Custom format, lexically sortable. ✓

All external technical claims appear sound.

---

### 2) Spec Updates

**subsystem-runner-orchestration.md:**

- **Add clarification on implementation language**: The spec mentions "Go binary" but ideas.md references Docker bundling. Add explicit note:
  - "Implementation: Single Go binary (run-agent) with embedded UI assets; future packaging as Docker container optional."

- **Clarify xAI status**: Latest Q&A says "park for post-MVP" but spec says "deferred post-MVP". Update Agent Backends section:
  - Change "xAI integration is deferred post-MVP" to "xAI integration is parked post-MVP (see subsystem-agent-backend-xai.md)."

- **Add compaction step detail**: ideas.md mentions "run compaction of message bus, fact propagation" but spec only says "may run compaction/fact propagation steps." Expand Configuration section to include:
  - "compaction_enabled (default: true; runs between Ralph iterations)"
  - "fact_propagation_enabled (default: true; promotes task facts to project level)"

- **Missing token reference format**: Spec says "token values may be provided inline or via @/path/to/token file references" but doesn't explain the @ syntax origin or validation. Add note in Configuration:
  - "Token file references use @ prefix (e.g., `token = \"@/path/to/file\"`); validated at config parse time."

- **Clarify serve subcommand scope**: Spec says "Serves the Monitoring UI and message bus API endpoints" but ideas.md says "TypeScript + React" and monitoring spec says embedded. Add:
  - "(TypeScript + React) and message bus API endpoints (REST + SSE)"

**TIPICS.md:**

- **Topic 2 (Run Lifecycle & Restart)**: Update with new compaction detail:
  - Add under "Decisions": "Compaction and fact propagation steps run between Ralph iterations (configurable)."

---

### 3) Questions to Remove/Resolve

**subsystem-runner-orchestration-QUESTIONS.md:**

**Remove (answered in git history):**

1. **Q: How should Perplexity and xAI backends be integrated?**
   - **Resolution**: Perplexity is native REST-backed (answered in backend specs); xAI parked post-MVP (commit 43e152d).
   - **Action**: Remove from QUESTIONS.md; details in subsystem-agent-backend-perplexity.md and subsystem-agent-backend-xai.md.

**Keep but update:**

2. **Q: How are run-agent binary updates/versioning handled?**
   - **Current status**: Proposed "Manual install/rebuild for MVP" is reasonable.
   - **Action**: Change from "A: TBD" to "A: Manual install/rebuild for MVP. Self-update mechanism deferred post-MVP."

3. **Q: Where is the config.hcl schema/version defined and validated?**
   - **Current status**: Proposed "Embed schema in Go binary; validate on startup" is standard practice.
   - **Action**: Change from "A: TBD" to "A: Schema embedded in Go binary; validated on startup. Unknown keys warn; defaults fill missing values."

**Remove (resolved in history qa file):**

From questions-history/subsystem-runner-orchestration-QUESTIONS-20260202.md, these are all answered and integrated into the main spec:
- Ralph restart linking (previous_run_id)
- Locking mechanism (no lockfile; timestamp+PID collision retry)
- Agent selection persistence (message bus query)
- Message-bus pollers (root agent handles, no dedicated poller)
- Orphaned runs (wait for children before marking complete)
- Stop/kill mechanism (SIGTERM -> SIGKILL with grace period)
- Idle/stuck/waiting detection (thresholds defined)
- Config precedence (CLI > env > task > project > global)
- Backend credential validation (no proactive validation)
- Error propagation (CRASH to message bus, root agent retries)
- Retry policy (exponential backoff)
- Concurrent run coordination (best-effort via message bus)
- Supervisor restart (re-discover PIDs, post SUPERVISOR_RESTART)

**Action**: These are resolved; no action needed.

---

### 4) New Open Questions

**subsystem-runner-orchestration-QUESTIONS.md (add):**

1. **Q: What is the grace period duration between SIGTERM and SIGKILL for stopping runs?**
   - **Proposed default**: 30 seconds (industry standard).
   - **A**: TBD (currently implicit in spec; needs explicit config parameter).

2. **Q: How should compaction/fact propagation failures between Ralph iterations be handled?**
   - **Proposed default**: Log error to message bus and continue restart; non-blocking.
   - **A**: TBD.

3. **Q: Should run-agent validate that the Go binary is the same version across parent/child runs, or allow version drift?**
   - **Proposed default**: No validation; allow version drift (agents prepend to PATH but don't enforce version).
   - **A**: TBD.

4. **Q: What is the behavior when the task folder already exists but TASK.md is empty or missing?**
   - **Proposed default**: Fail fast with error; empty TASK.md is invalid (spec says "non-empty").
   - **A**: TBD.

5. **Q: Should the Ralph loop enforce a maximum iteration count or total time budget to prevent infinite restarts?**
   - **Proposed default**: Yes; configurable max_restarts (default 100) and max_time_budget (default 24h).
   - **A**: TBD (config section mentions this but no explicit limits defined).

6. **Q: How should concurrent writes to run-info.yaml be handled if multiple processes (e.g., stop command + running agent exit) try to update it?**
   - **Proposed default**: Last-write-wins; use temp+rename atomic write pattern; no locking.
   - **A**: TBD.

**TIPICS.md (update Topic 2 - Run Lifecycle & Restart):**

- Add to "Open questions": Grace period duration, compaction error handling, version drift policy, empty TASK.md behavior, Ralph iteration limits, run-info.yaml concurrent write handling.

---

### 5) New Docs/Topics Suggested

**No new dedicated document required.**

However, consider:

1. **Explicit "Error Catalog"**: ideas.md references many error scenarios (missing env vars, backend failures, crashes) but there's no centralized error code/message catalog. Post-MVP, a dedicated doc like `ERROR-CODES.md` could standardize error messages and codes.

2. **"Compaction & Fact Propagation Spec"**: ideas.md and spec mention this behavior but details are vague. If compaction becomes complex (e.g., removing old messages, deduplicating facts), create `subsystem-compaction.md` post-MVP.

3. **"Agent Selection Heuristics"**: Spec says "may consult message bus events" but doesn't define heuristics. Post-MVP, a `AGENT-SELECTION-HEURISTICS.md` could detail:
   - How to parse recent START/STOP/CRASH events
   - Degraded backend detection logic
   - Weighted random vs round-robin implementation

---

## Summary

**Contradictions/Gaps Found:**
- xAI status: spec says "pending research" vs latest answer "parked post-MVP" → update spec wording
- Compaction detail: ideas.md mentions it, spec is vague → add config parameters
- Grace period for SIGKILL: implicit vs explicit → add config parameter and question
- Token @ syntax: mentioned but not explained → add validation note

**Key Resolved Questions:**
- All questions from questions-history/subsystem-runner-orchestration-QUESTIONS-20260202.md are resolved and integrated.

**New Open Questions:**
- 6 new questions identified (grace period, compaction errors, version drift, empty TASK.md, iteration limits, concurrent writes).

**No external fact verification performed** due to API unavailability, but all technical claims appear accurate based on common knowledge.
