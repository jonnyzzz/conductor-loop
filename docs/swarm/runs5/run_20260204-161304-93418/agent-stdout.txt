Now let me analyze the specs and create the review output:

## Environment & Invocation Contract Review

### 1) External Facts Check

Verified using web search:

**Go filepath.Clean behavior**: Confirmed that `filepath.Clean` performs OS-native path normalization by replacing forward slashes with `os.PathSeparator`, which is platform-specific (\ on Windows, / on Unix). The spec's proposal to use `filepath.Clean` for OS-native normalization is technically accurate.

**ISO-8601 UTC format**: The spec references ISO-8601 UTC for date injection. This is a standard format (YYYY-MM-DDTHH:mm:ss.sssZ). No verification needed.

**SIGTERM/SIGKILL signal handling**: The proposed 30s grace period between SIGTERM and SIGKILL is a common Unix convention. No verification issues found.

Sources:
- [filepath package - path/filepath - Go Packages](https://pkg.go.dev/path/filepath)

---

### 2) Spec Updates

**File: subsystem-env-contract.md**

Based on answered questions from git history and TIPICS.md topic 7, the following updates should be made:

- **Add section on CWD handling**: The spec mentions "Root agents rely on CWD (task folder)" but doesn't explicitly state that run-agent sets CWD before spawning. Should clarify: "run-agent sets CWD to the task folder for root agents before spawning."

- **Clarify prompt preamble format**: The spec says "prompt label (e.g., `RUN_FOLDER=/path/to/run`)" but should specify exact format and what other paths are included. From ideas.md lines 34, 159-161, it's clear task folder and run folder paths are prepended. Suggest explicit format specification:
  ```
  TASK_FOLDER=/absolute/path/to/task
  RUN_FOLDER=/absolute/path/to/run
  [agent prompt follows...]
  ```

- **Add output.md instruction**: The spec mentions "explicit instructions to write final output to `output.md`" in the preamble. Should include exact wording or reference the canonical template.

- **Missing PATH prepending details**: The spec states "run-agent prepends its own binary location to PATH" but doesn't specify collision handling (ideas.md line 224 mentions "put to the front" and "Make sure it's not already included like that from the parent process"). Should add: "run-agent checks if its binary location is already at the front of PATH; if not, it prepends it."

- **Add answered questions as resolved**: The three questions from the git history have been answered and should be incorporated into the spec:
  - Path normalization: OS-native using Go filepath.Clean
  - Environment inheritance: Full inheritance (no sandbox in MVP)
  - Signal handling: SIGTERM with 30s grace, then SIGKILL
  - Date/time injection: ISO-8601 UTC

**File: subsystem-env-contract-QUESTIONS.md**

- Replace "No open questions at this time" with the four questions currently listed (they were removed prematurely in the 399147b commit but are still listed in TIPICS.md as open).

---

### 3) Questions to Remove/Resolve

**File: subsystem-env-contract-QUESTIONS.md**

All three original questions were answered in commit 043db4eb and should be formally resolved in the spec:

1. **Q: Confirm the exact JRUN_* variable names**
   - **Resolution**: JRUN_PROJECT_ID, JRUN_TASK_ID, JRUN_ID, JRUN_PARENT_ID confirmed. PATH is updated to include run-agent binary. Task and run folder paths are prepended to prompt (not env vars).
   - **Action**: Move to spec as "Internal Variables Contract" section.

2. **Q: Which injected variables are read-only vs writable**
   - **Resolution**: Agents should not use environment variables for workflow. All path discovery is via prompt preamble and CWD.
   - **Action**: Already in spec, but strengthen language to explicitly state "Agents MUST NOT read JRUN_* variables or set any environment variables for workflow communication."

3. **Q: Should RUN_FOLDER be set for root agent**
   - **Resolution**: No. RUN_FOLDER is only in prompt preamble, not environment. Root relies on CWD; sub-agents rely on prompt.
   - **Action**: Already captured in spec.

The current QUESTIONS file says "No open questions" but TIPICS.md topic 7 still lists four open questions. This is a contradiction.

---

### 4) New Open Questions

**File: subsystem-env-contract-QUESTIONS.md**

The following questions from TIPICS.md topic 7 should be restored/added (they were prematurely removed):

1. **Q: How are paths normalized in the prompt preamble (OS-native vs POSIX style)?**
   - Proposed default: OS-native using Go filepath.Clean.
   - A: TBD.
   - **Note**: This should be resolved as "OS-native using filepath.Clean" based on implementation language choice.

2. **Q: Does the agent process inherit the full parent environment or a restricted set?**
   - Proposed default: Full inheritance in MVP (no sandbox).
   - A: TBD.
   - **Note**: This should be resolved as "Full inheritance" based on TIPICS.md decisions.

3. **Q: What is the signal handling contract between run-agent and agents (SIGTERM propagation, grace period)?**
   - Proposed default: run-agent forwards SIGTERM to the agent process group and waits 30s before SIGKILL.
   - A: TBD.
   - **Note**: This should be resolved based on TIPICS.md topic 2 (30s grace period is decided).

4. **Q: Should the current date/time be injected into the prompt preamble for agents?**
   - Proposed default: Yes, ISO-8601 UTC.
   - A: TBD.
   - **Note**: This should be explicitly decided and added to spec if yes.

**Additional new questions identified:**

5. **Q: What format should be used for the prompt preamble (structured vs free-text)?**
   - Proposed default: Structured key=value format on separate lines before the actual prompt content.
   - A: TBD.
   - **Rationale**: Spec mentions "prompt label" but doesn't specify if it's machine-parseable or human-readable only. From ideas.md line 32, environment variables were mentioned, suggesting key=value format may be intentional for agent parsing.

6. **Q: Should the prompt preamble include project root path in addition to task and run folders?**
   - Proposed default: Yes, include PROJECT_ROOT for code-change agents who need to work in project root (per TIPICS.md topic 4 CWD guidance).
   - A: TBD.
   - **Rationale**: ideas.md line 86 mentions "home-folders.md" which tracks project source folders, but the prompt preamble spec doesn't mention project root.

7. **Q: How should run-agent handle PATH collision if its binary is already in PATH but not at the front?**
   - Proposed default: Remove existing occurrence and prepend (ideas.md line 224).
   - A: TBD.

---

### 5) New Docs/Topics Suggested

**No new dedicated documents required** at this time. The environment & invocation contract is appropriately scoped and bounded.

However, consider these cross-references that should be strengthened:

1. **Prompt Template Reference**: The spec should reference a canonical prompt template document (if it exists) that defines the exact preamble format. If it doesn't exist, subsystem-agent-protocol.md should include an example template.

2. **CWD Working Directory Policy**: Currently split between subsystem-env-contract.md (mentions CWD) and subsystem-agent-protocol.md (has CWD guidance per agent type). Consider consolidating CWD rules into env-contract since it's part of the invocation contract.

3. **Backend Token Injection Mapping**: The spec mentions "backend-specific" token naming but doesn't reference where that mapping is documented. Should add explicit references to subsystem-agent-backend-*.md files.

---

## Summary of Key Contradictions Found

1. **Premature question removal**: The git history shows all questions were marked answered and removed in commit 399147b, but TIPICS.md topic 7 still lists them as open. The answers from commit 043db4eb should be integrated into the spec, and the questions should remain open with "A: Decided" until formally merged.

2. **Missing implementation decisions**: Four questions from TIPICS.md have clear answers in other subsystem decisions but haven't been formally resolved in this spec:
   - Path normalization → OS-native (Go implementation)
   - Environment inheritance → Full (no sandbox MVP)
   - Signal handling → SIGTERM+30s (topic 2)
   - Date injection → Should be decided explicitly

3. **Incomplete prompt preamble specification**: The spec describes what's in the preamble (paths, output.md instruction) but not the exact format, which creates ambiguity for implementers.

4. **PATH handling underspecified**: ideas.md has specific requirements (line 224) that aren't fully captured in the spec.
