The Perplexity API requires authentication. Let me check if SSE is a well-established protocol that doesn't require verification in the documentation:

Based on my analysis of the documents and git history, I can now provide the comprehensive review:

## 1) External Facts Check

**Status: No external verification needed**

The design documents reference these external technologies:
- **SSE (Server-Sent Events)**: Standard W3C protocol for server-to-client streaming over HTTP; widely supported.
- **WebSockets**: Standard protocol for bidirectional communication; well-established.
- **SIGTERM/SIGKILL**: Standard POSIX signals for process termination; no verification needed.
- **HCL (HashiCorp Configuration Language)**: Established configuration format; no verification needed.

All external references are to well-established standards and protocols. No factual claims require verification via Perplexity.

---

## 2) TIPICS.md Updates

**Topic 4: Agent Governance & Delegation**

### Decisions to clarify:
- **"Git Pro" behavior**: The latest answer (43e152d) clarifies this is guidance in THE_PROMPT_v5.md, but that file doesn't exist in the repo yet. Decision should acknowledge this is a **future prompt template** rather than an existing file.

### Decisions to add:
- **Parent blocking behavior**: Currently listed as an open question, but ideas.md and subsystem-runner-orchestration.md both describe `run-agent job` as blocking until agent completion. Should be elevated to a decision.
- **Message bus poller timing**: Currently marked as open question "when to introduce post-MVP", but specs already describe root agent polling as the MVP approach. This is essentially decided.

### Proposed additions:
```
- Parent agents block on `run-agent job` until child completes; parent context is preserved during delegation.
- THE_PROMPT_v5.md is a future prompt template for git safety guidance; spec references are placeholders until implementation.
```

### Open questions to update:
- Remove "Parent blocking vs. exit behavior" (now decided: blocks)
- Remove "When to introduce message-bus poller" (now decided: post-MVP only if needed)
- Update "Git Pro" question to be more specific: "What is the structure and location of THE_PROMPT_v5.md template file?"

---

## 3) Spec Updates

### **subsystem-agent-protocol.md**

**Line 75-76** – Git Pro reference:
```diff
- Git Pro guidance is provided via THE_PROMPT_v5.md; extend that prompt with small-logical-commit instructions.
+ Git Pro guidance will be provided via a future THE_PROMPT_v5.md prompt template; include small-logical-commit instructions and selective file staging guidance.
```

**Add new section after line 61** – Parent blocking behavior:
```markdown
## Delegation & Parent Blocking
- Parent agents invoke sub-agents via `run-agent job` and block until completion.
- Blocking preserves parent context for result synthesis and follow-up decisions.
- Parents may monitor child TASK_STATE.md/output.md during execution.
- Alternative: parent may exit after delegation if it has no follow-up work; Ralph will restart root agent to check completion.
```

**Line 42-43** – Clarify polling cadence:
```diff
- Root agent is responsible for polling and processing message bus updates in MVP (no dedicated poller service).
- Poll for new messages as often as possible; read only new content.
+ Root agent polls message bus between major work steps; aim for sub-minute latency in MVP.
+ Use `run-agent bus poll --wait` to block until new messages arrive (reduces busy-polling).
+ Dedicated poller service is deferred to post-MVP based on observed latency/volume needs.
```

### **subsystem-runner-orchestration.md**

**Line 30** – Clarify job blocking:
```diff
- Starts one agent run and blocks until completion.
+ Starts one agent run and blocks until the agent process exits (preserves parent context for result handling).
```

**Line 97-98** – Add poller decision:
```markdown
## Message Bus Polling (MVP)
- Root agent is responsible for polling PROJECT-MESSAGE-BUS.md and TASK-MESSAGE-BUS.md.
- No dedicated poller subprocess in MVP; root agent checks between work steps.
- Dedicated poller may be introduced post-MVP if message latency or volume requires it.
```

---

## 4) Questions to Remove/Resolve

### **subsystem-agent-protocol-QUESTIONS.md**

**Current question (line 1-5)**:
```
Q: How are "Git Pro" skills defined and injected into agent prompts/tooling?
Proposed default: Runner includes explicit git-safety instructions in the system prompt; optional tool wrappers can enforce safe staging.
A: No specific actions. We use basic descriptions to in the THE_PROMPT_v5.md to explain how to use Git. Add sections there for small logical commits.
```

**Resolution**: 
- The answer confirms guidance-only approach (no tool wrappers).
- THE_PROMPT_v5.md doesn't exist yet and is a planning artifact.
- Question format is malformed (answer appended without proper structure).

**Action**: Remove this question entirely; replace with refined question (see section 5).

---

**Legacy question from TIPICS (not in current file but referenced)**:
```
Q: Parent blocking vs. exit behavior after delegation.
```

**Resolution**: 
- subsystem-runner-orchestration.md line 30 states `run-agent job` blocks until completion.
- ideas.md line 211 confirms detachment from terminal but synchronous waiting on PID.
- This is a decided behavior: parent blocks.

**Action**: Remove from open questions; add to TIPICS decisions.

---

**Legacy question from TIPICS**:
```
Q: When to introduce a dedicated message-bus poller (post-MVP).
```

**Resolution**:
- subsystem-agent-protocol.md line 41-42 states root agent polls in MVP.
- subsystem-runner-orchestration.md line 23 confirms no dedicated poller in MVP.
- Decision is clear: post-MVP only if needed.

**Action**: Remove from open questions; clarify in specs that this is a post-MVP optimization trigger.

---

## 5) New Open Questions

### **subsystem-agent-protocol-QUESTIONS.md**

Add:
```markdown
- Q: What is the exact structure and file location of THE_PROMPT_v5.md? | Proposed default: Create as a template in the runner codebase; include sections for git safety (selective staging, logical commits), message bus usage, delegation guidelines, and TASK_STATE maintenance. | A: TBD.

- Q: Should `run-agent job` expose a --detach flag for fire-and-forget delegation, or always block? | Proposed default: Always block in MVP for simplicity; add --detach post-MVP if monitoring-heavy workflows emerge. | A: TBD.

- Q: What is the recommended polling interval for root agents checking message bus between work steps? | Proposed default: Check every 30-60 seconds during long operations; use `--wait` flag on `run-agent bus poll` to avoid busy-polling. | A: TBD.
```

### **subsystem-runner-orchestration-QUESTIONS.md**

**Existing question** (line 1-5):
```
Q: What is the xAI integration strategy and model selection for coding agents?
Proposed default: Run a focused research task and draft the xAI backend spec before implementation.
A: We are not going to support xAI just now, park the work for post-MVP
```

**Action**: This is answered; move to TIPICS decisions as "xAI integration is deferred post-MVP; OpenCode agent is the planned approach pending research."

Add new question:
```markdown
- Q: How does run-agent detect and recover from child processes that detach from the process group (double-fork daemons)? | Proposed default: run-info.yaml tracks original PID; runner logs warning if PID exits but children survive; no forced cleanup in MVP. | A: TBD.
```

---

## Summary of Changes

### TIPICS.md – Topic 4:
- **Add decisions**: Parent blocking, THE_PROMPT_v5.md is future template, message bus polling is root agent responsibility in MVP.
- **Remove open questions**: Parent blocking (decided), poller timing (decided).
- **Update open question**: Refine "Git Pro" to ask about THE_PROMPT_v5.md structure and location.

### subsystem-agent-protocol.md:
- Clarify THE_PROMPT_v5.md is a future artifact.
- Add delegation & blocking section.
- Specify polling best practices with `--wait` flag.

### subsystem-runner-orchestration.md:
- Emphasize `run-agent job` blocks to preserve context.
- Add message bus polling section describing MVP approach.

### Questions files:
- Remove/resolve: Git Pro (malformed), parent blocking (decided), poller timing (decided), xAI (answered).
- Add: THE_PROMPT_v5.md structure, --detach flag, polling interval, double-fork handling.
