# Message Bus Tooling - Questions

- Q: What are the required header fields for each message entry, and what is the canonical msg_id format?
  Proposed default: Required: msg_id, ts, type, project; optional: task, run_id, parents[]; msg_id = ULID generated by run-agent bus tooling.
  A: TBD.

- Q: Should tooling read legacy single-line entries, or require YAML front-matter only?
  Proposed default: Read both; new writes always YAML front-matter; provide optional migration tool.
  A: TBD.

- Q: What is the exact concurrency/atomicity strategy for appending messages?
  Proposed default: Advisory file lock + append + fsync for new entries; temp+rename only for compaction.
  A: TBD.

- Q: What ordering guarantees should bus readers assume when multiple agents append concurrently?
  Proposed default: Timestamp ordering only; ties resolved by msg_id; no global FIFO guarantee.
  A: TBD.

- Q: Should poll/pager support cursor persistence (e.g., --cursor-file) or leave it entirely to callers?
  Proposed default: Optional --cursor-file storing last msg_id; default caller-managed.
  A: TBD.

- Q: Are there message size limits and attachment conventions for large bodies?
  Proposed default: Soft limit 64KB; larger content stored in a file with attachment_path metadata.
  A: TBD.

- Q: Should task-level messages be mirrored into the project bus, or remain task-only with UI aggregation?
  Proposed default: No mirroring; UI aggregates project/task buses at read time.
  A: TBD.

- Q: How should corrections/updates to prior messages be represented (supersedes semantics)?
  Proposed default: Append-only new entry with supersedes[] referencing prior msg_id (same bus scope only); UI collapses superseded entries.
  A: TBD.

- Q: Should the bus support structured query (filter by type/run_id/date range) or only sequential read?
  Proposed default: Sequential read for MVP; tooling provides post-filter; structured index added later if needed.
  A: TBD.

- Q: What is the compaction/archival strategy for MESSAGE-BUS growth over time?
  Proposed default: Rotate on size threshold (e.g., 10MB); archive old chunks to MESSAGE-BUS-archive/<timestamp>.md; readers scan all chunks.
  A: TBD.

- Q: What is the canonical method for agents to post messages (direct file append vs run-agent bus CLI vs library)?
  Proposed default: Use run-agent bus CLI (or library wrapper) only; direct file writes are disallowed.
  A: TBD.
