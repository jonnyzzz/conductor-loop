I will start by listing the files in the directory to confirm the specific filenames and then read the core context files (`ideas.md`, `SUBSYSTEMS.md`, `TOPICS.md`, `RESEARCH-FINDINGS.md`) to establish the baseline for the review.

I will read the specification files for the Runner Orchestration and Storage Layout subsystems, including their related schema and questions files, to assess their completeness and consistency.

I will now read the specification files for the Message Bus and Monitoring UI subsystems to continue the verification process.

I will read the specification files for the Agent Protocol and Environment Contract subsystems to continue the verification process.

I will read the specification files for the Agent Backend subsystems (Claude, Codex, Gemini, Perplexity, and xAI) and their corresponding questions files to complete the verification process.

I will now generate the verification report based on the analysis of the specification files.

# Specification Verification Report

### 1. Summary
The agent swarm subsystem specifications are high-quality, well-structured, and largely complete for an MVP. The separation of concerns between the Runner, Storage, Message Bus, and UI is logical and clearly defined. The use of schemas (`run-info.yaml`, `config.hcl`) and strict directory layouts provides a solid foundation for implementation.

### 2. Completeness Issues
*   **Frontend-Backend API Contract**: `subsystem-monitoring-ui.md` refers to "Topic 10 (Frontend-Backend API Contract)" for exact endpoint paths and schemas. However, this content exists only as a planning file (`prompts/planning-round4/topic-10-frontend-backend-api-contract.md`) and has not been formalized into a `subsystem-*.md` specification.
*   **Backend CLI Flags**: The specifications for Claude, Codex, and Gemini backends (`subsystem-agent-backend-*.md`) rely on "Run experiments" or "look at run-agent.sh" to determine the final CLI flags. These are not fully specified.

### 3. Consistency Issues
*   **Perplexity Output Handling**: `subsystem-agent-backend-perplexity.md` states that the adapter "writes the final response to stdout (captured to agent-stdout.txt); no output.md is written". This deviates from the standard contract where `output.md` is the canonical result file (as per `subsystem-storage-layout.md` and `subsystem-runner-orchestration.md`). The UI default view is `output.md`, so this inconsistency may cause display issues.

### 4. Technical Concerns
*   **Perplexity Streaming**: The Perplexity spec notes "Research needed for Perplexity API streaming capabilities." If streaming is not supported, the "idle/stuck detection" mechanism (based on stdout activity) might trigger falsely during long generation times unless periodic "keep-alive" logs are emitted by the adapter.
*   **CLI Flag Stability**: Reliance on experimental CLI flags for backends creates a risk that the implementation phase will require significant research/debugging, potentially invalidating the "stable invocation contract" goal.

### 5. Clarification Needed
*   **API Schema Definition**: The specific JSON schemas for the API endpoints (referenced in `subsystem-monitoring-ui.md`) are missing from the formal specs.

### 6. Positive Findings
*   **Clear Architecture**: The division into Runner, Storage, Message Bus, and UI is excellent and well-documented in `SUBSYSTEMS.md`.
*   **Robust Schemas**: `subsystem-runner-orchestration-config-schema.md` and `subsystem-storage-layout-run-info-schema.md` are comprehensive and precise.
*   **Research Alignment**: Technical decisions (HCL, Ring UI, process group signaling, atomic file writes) are well-supported by `RESEARCH-FINDINGS.md`.
*   **Safety**: The "No Sandbox" decision is clearly documented in `subsystem-agent-protocol.md` with appropriate mitigations (git safety guidance, prompt injection of paths).

### 7. Recommendations
1.  **Formalize API Contract**: Convert the content of `prompts/planning-round4/topic-10-frontend-backend-api-contract.md` into a formal `subsystem-frontend-backend-api-contract.md` specification.
2.  **Standardize Perplexity Output**: Update the Perplexity adapter spec to write its final response to `output.md` (in addition to or instead of `agent-stdout.txt`) to maintain consistency with other backends and the UI.
3.  **Finalize Backend Flags**: Perform the necessary experiments for Claude, Codex, and Gemini CLI flags and update their specs with the exact commands to be used.
4.  **Define Perplexity Liveness**: Explicitly specify a "keep-alive" logging mechanism for the Perplexity adapter if API streaming is unavailable, to prevent the runner from killing it as "stuck".
